<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ph√¢n C√¥ng Tr·ª±c Nh·∫≠t</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:'Inter',sans-serif;background:linear-gradient(120deg,#e0f2ff,#f5faff);}
.header{background:linear-gradient(135deg,#3b82f6,#06b6d4);color:white;padding:25px;text-align:center;}
.container{max-width:1200px;margin:-30px auto 40px;padding:20px;}
.card{background:white;border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 8px 20px rgba(0,0,0,.08);}
h3{color:#1e3a8a;margin-top:0}
textarea{width:100%;height:120px;padding:10px;border-radius:8px;border:1px solid #cbd5e1;}
.task{display:flex;justify-content:space-between;padding:6px 0}
.task input{width:60px}
button{background:linear-gradient(135deg,#3b82f6,#06b6d4);color:white;border:none;border-radius:8px;padding:12px;cursor:pointer}
.btn-outline{background:white;color:#2563eb;border:2px solid #2563eb}
.day-box{border:1px solid #e2e8f0;border-radius:10px;padding:10px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
.buoi label{margin-left:15px;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:15px}
th{background:#2563eb;color:white;padding:8px}
td{padding:8px;border:1px solid #e2e8f0;vertical-align:top}
tr:nth-child(even){background:#f8fafc}
.sang{background:#ecfeff}
.chieu{background:#fff7ed}
.stat th{background:#0ea5e9}
@media(max-width:600px){
  .task{flex-direction:column;align-items:flex-start}
  .task input{width:100%;margin-top:5px}
  .day-box{flex-direction:column;align-items:flex-start}
}
</style>
</head>
<body>
<div class="header">
<h1>üìã B·∫¢NG PH√ÇN C√îNG TR·ª∞C NH·∫¨T</h1>
<p>M·ªói Th·ª© ch·ªçn S√°ng / Chi·ªÅu ri√™ng</p>
</div>

<div class="container">
<div class="card">
<h3>üë• Danh s√°ch th√†nh vi√™n</h3>
<textarea id="members" placeholder="M·ªói d√≤ng 1 ng∆∞·ªùi"></textarea>
<button class="btn-outline" onclick="shuffleMembers()">üîÄ X√°o tr·ªôn th√†nh vi√™n</button>
</div>

<div class="card">
<h3>üßπ C√¥ng vi·ªác & s·ªë l∆∞·ª£ng</h3>
<div class="task">Qu√©t l·ªõp <input type="number" id="quet" value="1"></div>
<div class="task">Lau b·∫£ng & Thay n∆∞·ªõc <input type="number" id="laubang" value="1"></div>
<div class="task">ƒê·ªï r√°c <input type="number" id="dorac" value="1"></div>
<div class="task">Lau l·ªõp (ch·ªâ Th·ª© 6) <input type="number" id="laulop" value="2"></div>
</div>

<div class="card">
<h3>üìÖ Ch·ªçn bu·ªïi cho t·ª´ng Th·ª©</h3>
<div id="days"></div>
</div>

<button onclick="phanCong()">‚ú® T·∫°o b·∫£ng ph√¢n c√¥ng & L∆∞u</button>

<div class="card" id="schedule"></div>
<div class="card" id="stats"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getFirestore, doc, setDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

// ----------------------
// THAY B·∫∞NG TH√îNG TIN FIREBASE C·ª¶A B·∫†N
const firebaseConfig = { 
  apiKey : "AIzaSyDQOiW_pYVvo6n0C2KBAcMgPqqTwKMUhGw" , 
  authDomain : "trucnhatclass.firebaseapp.com" , 
  projectId : "trucnhatclass" , 
  storageBucket : "trucnhatclass.firebasestorage.app" , 
  messagingSenderId : "953049929216" , 
  appId : "1:953049929216:web:2363dabb9446f577b4eae5" 
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
// ----------------------

const dayNames=["Th·ª© 2","Th·ª© 3","Th·ª© 4","Th·ª© 5","Th·ª© 6"];
let memberList=[];

function renderDays(){
    const d=document.getElementById("days");
    d.innerHTML="";
    dayNames.forEach((day,i)=>{
        d.innerHTML+=`
        <div class="day-box">
            <strong>${day}</strong>
            <div class="buoi">
                <label><input type="checkbox" id="sang${i}"> S√°ng</label>
                <label><input type="checkbox" id="chieu${i}"> Chi·ªÅu</label>
            </div>
        </div>`;
    });
}
renderDays();

function shuffleMembers(){
    memberList=document.getElementById("members").value.split("\n").map(m=>m.trim()).filter(Boolean);
    for(let i=memberList.length-1;i>0;i--){
        let j=Math.floor(Math.random()*(i+1));
        [memberList[i],memberList[j]]=[memberList[j],memberList[i]];
    }
    alert("ƒê√£ x√°o tr·ªôn th√†nh vi√™n");
}

function phanCong(){
    memberList=document.getElementById("members").value.split("\n").map(m=>m.trim()).filter(Boolean);
    if(memberList.length===0){alert("Ch∆∞a c√≥ th√†nh vi√™n");return;}
    let stat={};
    memberList.forEach(m=>stat[m]={sang:0,chieu:0,total:0});
    let tasks=[
        {name:"Qu√©t l·ªõp",count:+document.getElementById("quet").value},
        {name:"Lau b·∫£ng & Thay n∆∞·ªõc",count:+document.getElementById("laubang").value},
        {name:"ƒê·ªï r√°c",count:+document.getElementById("dorac").value}
    ];
    let idx=0;
    let html=`<table><tr><th>Th·ª©</th><th>S√°ng</th><th>Chi·ªÅu</th></tr>`;
    dayNames.forEach((day,i)=>{
        let sang="", chieu="";
        if(document.getElementById(`sang${i}`).checked){
            tasks.forEach(t=>{
                let p=[];
                for(let k=0;k<t.count;k++){
                    let m=memberList[idx%memberList.length];
                    p.push(m); stat[m].sang++; stat[m].total++; idx++;
                }
                sang+=`<b>${t.name}</b>: ${p.join(", ")}<br>`;
            });
            if(day==="Th·ª© 6"){
                let p=[];
                for(let k=0;k<+document.getElementById("laulop").value;k++){
                    let m=memberList[idx%memberList.length];
                    p.push(m); stat[m].sang++; stat[m].total++; idx++;
                }
                sang+=`<b>Lau l·ªõp</b>: ${p.join(", ")}<br>`;
            }
        }
        if(document.getElementById(`chieu${i}`).checked){
            tasks.forEach(t=>{
                let p=[];
                for(let k=0;k<t.count;k++){
                    let m=memberList[idx%memberList.length];
                    p.push(m); stat[m].chieu++; stat[m].total++; idx++;
                }
                chieu+=`<b>${t.name}</b>: ${p.join(", ")}<br>`;
            });
            if(day==="Th·ª© 6"){
                let p=[];
                for(let k=0;k<+document.getElementById("laulop").value;k++){
                    let m=memberList[idx%memberList.length];
                    p.push(m); stat[m].chieu++; stat[m].total++; idx++;
                }
                chieu+=`<b>Lau l·ªõp</b>: ${p.join(", ")}<br>`;
            }
        }
        html+=`<tr><td><b>${day}</b></td><td class="sang">${sang||"-"}</td><td class="chieu">${chieu||"-"}</td></tr>`;
    });
    html+="</table>";
    document.getElementById("schedule").innerHTML="<h3>üìå B·∫£ng ph√¢n c√¥ng</h3>"+html;

    let statHTML=`<h3>üìä Th·ªëng k√™ s·ªë l·∫ßn tr·ª±c</h3><table class="stat"><tr><th>Th√†nh vi√™n</th><th>S√°ng</th><th>Chi·ªÅu</th><th>T·ªïng</th></tr>`;
    Object.keys(stat).forEach(m=>{
        statHTML+=`<tr><td>${m}</td><td>${stat[m].sang}</td><td>${stat[m].chieu}</td><td><b>${stat[m].total}</b></td></tr>`;
    });
    statHTML+="</table>";
    document.getElementById("stats").innerHTML=statHTML;

    // L∆∞u l√™n Firebase
    saveToFirebase(memberList,tasks,stat);
}

// ---------------- FIREBASE ----------------
async function saveToFirebase(members,tasks,stats){
    const daysData={};
    dayNames.forEach((day,i)=>{
        daysData[day]={sang:document.getElementById(`sang${i}`).checked,chieu:document.getElementById(`chieu${i}`).checked};
    });
    await setDoc(doc(db,"class","main"),{
        members,tasks,days:daysData,stats,updatedAt:Date.now()
    });
}

// ---------------- LOAD FIREBASE ----------------
onSnapshot(doc(db,"class","main"), (snap)=>{
    if(snap.exists()){
        const data=snap.data();
        // Load members
        document.getElementById("members").value=data.members.join("\n");
        // Load days
        dayNames.forEach((day,i)=>{
            document.getElementById(`sang${i}`).checked=data.days[day].sang;
            document.getElementById(`chieu${i}`).checked=data.days[day].chieu;
        });
        // Load b·∫£ng ph√¢n c√¥ng n·∫øu c√≥
        if(data.stats) phanCong();
    }
});
</script>
</body>
</html>
